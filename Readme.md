# ozonTest

# Сервис постов и комментариев на GraphQL

Этот проект представляет собой тестовое заданияе по использованию GraphQL для реализации системы добавления и чтения постов и комментариев.

## Start
1. `git clone git@github.com:riddion72/ozon_test.git`
2. `make` в корневой папке, запустится реализация хранения данных в PostgreSQL(ну или если не получится порключиться, он сам переключится на in-memory)
3. http://localhost:8081/ тут запустится GraphQL Playground
4. В файле `tests/test.txt` лежит несколько готовых запросов для провегки функционала
5. самый простой способ проверить in-memory реализацию хранилища это зарустить `make inmmem` запустится без docker`а и Postgre

## Комментарии по проекту

- `config/config.yml` конфиг с основными настройками сервера
    - `complexitylimit` лимит сложности запроса
    - `db` можно убрать всю инвормацию о базе данных, и тогда сервер сразу запустится на in-memory
    - `logger` настройка уровня логирования (есть `local` `dev` `prod`) постарался логины/пароли в логи не писать
- `makefile` есть несколько целей для удобства
    - `make stop` остонавливает docker'ы
    - `make restart` перезапускает docker'ы
    - `make inmem` просто запускает `go run main.go` без docker'а и PostgreSQL
    - `make test` запускает го тесты
    - `make build` 
    - `make run`

### Основные функции

- `Query`
    - `posts` Просмотр списка постов (с пагинацией).
    - `post` Просмотр поста и комментариев под ним.
    - `comments` Просмотр комментариев под конкретным постом.
    - `replies` Просмотр комментариев под конкретным коментарием.

- `Mutation`
    - `createPost` Создание постоа.
    - `createComment` Создание коментария подпостом или коментарием.
    - `closeCommentsPost` Пользователь, написавший пост, может запретить оставление комментариев к своему посту.
- `Subscription`
    - `commentAdded` подписка на новые комментарии без необходимости повторного запроса.

- Иерархическая организация комментариев с возможностью вложенности.
- Ограничение длины текста комментария до 2000 символов.
- Пагинация для получения списка комментариев(добровольнопринудительная)
- Подписка на новые комментарии к постам через GraphQL Subscriptions.
- Настроен подсчет сложности запросов (по идее это должно решить проблемы с n+1 запросами и большой вложенностью комментариев)
- Покрытие unit-тестами слоёв storage и service.